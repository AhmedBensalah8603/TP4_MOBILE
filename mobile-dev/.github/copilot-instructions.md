# GitHub Copilot instructions for this repo

**Short goal:** Help AI agents be immediately productive in the Aquora Flutter dashboard project.

## Quick facts ‚úÖ
- Language: Dart + Flutter (multi-platform: Android, iOS, Web, Windows, macOS)
- Entrypoint: `lib/main.dart` (initializes Firebase and shows `WelcomePage`)
- Firebase config: `lib/firebase_options.dart` (generated by FlutterFire CLI)
- UI is RTL / Arabic-first and uses `GoogleFonts.cairo` for typography
- Lints: `flutter_lints` enabled (run `flutter analyze`)
- State management: `provider` is used for simple app state and auth (`lib/state/auth_provider.dart`)

## Development commands (run these locally) üîß
- Setup: `flutter pub get`
- Lint & static analysis: `flutter analyze`
- Run (desktop): `flutter run -d windows` (or `-d <device>`)
- Run (mobile): `flutter run` (choose device/emulator)
- Build APK: `flutter build apk`
- Build web: `flutter build web`
- Format code: `dart format .`
- Regenerate Firebase config (if needed): `flutterfire configure` ‚Üí updates `firebase.json` & `lib/firebase_options.dart`
- Android gradle: use included wrapper `android/gradlew` or `./gradlew.bat` on Windows for platform-specific builds
- Local backend: use `--dart-define=API_BASE_URL` to point the app at your backend; default is `http://localhost:7071` (see `lib/utils/config.dart`)

## Project-specific patterns & conventions üí°
- RTL-first UI: Many screens wrap text/widgets with `Directionality(textDirection: TextDirection.rtl)` (example: `lib/login_page.dart`, `lib/home_page.dart`). Preserve RTL when changing UI.
- Fonts: Use `GoogleFonts.cairo()` or `GoogleFonts.cairoTextTheme()` for Arabic typography (example: `lib/home_page.dart`).
- String placement: Strings are inline in Arabic (no `intl` or i18n currently). When adding UI copy, follow existing pattern and set `textDirection` accordingly.
- Navigation: Uses `Navigator.push(MaterialPageRoute(...))` for page navigation. Keep this style unless a cross-cutting routing change is requested (no router package present).
- UI composition: Pages use helper builders (e.g., `_buildWideCard` in `lib/home_page.dart`) and custom widgets (e.g., `CustomClipper` in `lib/login_page.dart`). Follow the existing pattern: small helper methods inside `State`/`StatelessWidget` classes.
- Firebase: Project uses `firebase_core` (initialized in `lib/main.dart`) and platform files (`android/app/google-services.json` and `firebase.json`). Update `lib/firebase_options.dart` via FlutterFire CLI, not by manual edits.

## Files to look at for examples üìÅ
- App entry & Firebase: `lib/main.dart`, `lib/firebase_options.dart`
- Home/dashboard patterns: `lib/home_page.dart` (`_buildWideCard`, bottom nav bar)
- Auth / onboarding: `lib/login_page.dart`, `lib/intro_page.dart` (RTL inputs, custom clipper)
- Graphs/charts: files like `lib/water_history_page.dart`, `lib/temp_history_page.dart` show how charts/data are displayed

## Coding style & checks ‚úçÔ∏è
- Follow `flutter_lints` rules; prefer `const` where possible and keep widget functions small and testable.
- Use `dart format .` and `flutter analyze` as pre-commit checks.
- File naming: majority use `snake_case.dart` but a few files are capitalized (`AdviceDialog.dart`). New files should use `snake_case.dart`.

## Cautions & gotchas ‚ö†Ô∏è
- Duplicate `main()` functions: `lib/home_page.dart` contains a `main()` for a standalone preview‚Äî**do not** change `lib/main.dart` unless you intend to change the app entrypoint. Prefer edits starting from `lib/main.dart`.
- Secrets: `lib/firebase_options.dart` contains Firebase project keys generated by FlutterFire CLI and `android/app/google-services.json` exists. Be careful when changing or rotating keys; prefer using `flutterfire configure` for reprovisioning.
- No tests yet: There are no unit/widget tests in `/test`. If adding tests, follow the existing widget composition and prefer Widget tests using `flutter_test`.

## Recommended tasks for AI agents (concise) ‚úÖ
- When modifying UI: preserve RTL, use `GoogleFonts.cairo`, and update assets in `pubspec.yaml` if adding images.
- When touching Firebase behavior: update via FlutterFire CLI and ensure `lib/firebase_options.dart` remains correct for all platforms.
- Backend & Avatar: The app expects a backend endpoint `POST /avatar/message` which accepts { text } and returns JSON { replyText, ttsUrl? } where `ttsUrl` is an optional URL to generated audio. Use `--dart-define=API_BASE_URL` to point to your backend. A prototype backend stub is available at `/backend` (FastAPI) which implements `/avatar/message` and local TTS generation when `AZURE_TTS_KEY` + `AZURE_TTS_REGION` are provided.
- Azure OpenAI: when `AZURE_OPENAI_ENDPOINT`, `AZURE_OPENAI_KEY`, and `AZURE_OPENAI_DEPLOYMENT` are set, the backend will call Azure OpenAI Chat Completions and return its reply as `replyText`.
- TTS playback: the app uses `audioplayers` to play audio returned by `ttsUrl`. If audio generation is server-side prefer returning short mp3/wav URLs (the stub saves mp3 files under `/backend/static/tts` and serves them at `/tts/{filename}`).
- Add small, focused widget tests when adding a new visual or logic component (put tests under `/test`).

---
If anything above is unclear or you want me to add examples/snippets for a specific workflow (e.g., regenerating Firebase config, adding a new page with RTL support, or creating a CI job), tell me which part to expand and I‚Äôll iterate. üëá